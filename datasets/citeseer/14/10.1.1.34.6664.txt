estimating number clusters dataset gap statistic robert tibshirani walther trevor hastie march propose method gap statistic estimating number clusters groups set data 
technique uses output clustering algorithm means hierarchical comparing change cluster dispersion expected appropriate null distribution 
theory developed proposal simulation study shows gap statistic usually outperforms methods proposed literature 
brie explore application technique problem estimating number linear principal components 
cluster analysis important tool unsupervised learning problem nding groups data help response variable 
major challenge cluster analysis estimation optimal number clusters 
top right shows typical plot error measure cluster dispersion de ned clustering procedure versus number clusters employed error measure decreases monotonically division biostatistics department statistics stanford university stanford ca stat stanford edu department statistics stanford university stanford ca walther stat stanford edu department statistics division biostatistics stanford university stanford ca trevor stat stanford edu number clusters increases decrease markedly 
statistical folklore location elbow indicates appropriate number clusters 
goal provide statistical procedure formalize heuristic 
studies elbow phenomenon see sugar sugar 

comprehensive survey methods estimating number clusters milligan cooper gordon discusses best performers 
methods described sections compared method 
propose gap method estimating number clusters 
designed applicable virtually clustering method 
simplicity theoretical part analysis focus widely means clustering procedure 
gap statistic data fx ij consists features measured independent observations 
ii denote distance observations common choice ii squared euclidean distance ij suppose clustered data clusters denoting indices observations cluster jc cr ii sum pairwise distances points cluster set distance squared euclidean distance pooled cluster sum squares cluster means factor exactly 
sample size suppressed notation 
idea approach standardize graph log comparing expectation appropriate null distribution data 
estimate optimal number clusters value log falls farthest curve 
de ne gap log log denotes expectation sample size distribution expectation generally depends due data dependent optimization implicit computation 
estimate value maximizing gap take sampling distribution account 
note estimate general applicable clustering method distance measure ii motivation gap statistic consider clustering uniform data points dimensions centers 
assuming centers align equally spaced fashion expectation log approximately log pn log constant data separated clusters expect log decrease faster expected rate log essentially adding unnecessary cluster center middle approximately uniform cloud simple algebra shows log decrease slowly expected rate 
gap statistic largest motivation note case special gaussian mixture model log interpretation log likelihood see scott simons 
develop gap statistic operational procedure need nd appropriate distribution control sampling distribution gap statistic 
distribution framework adopt null model single component reject favor component model strongest evidence warrants 
wish simultaneously screen evidence 
approach guarding erroneous rejection component model similar roeder 
component cluster distribution appropriately modeled log concave distribution density form exp concave function distribution degenerate 
standard examples course normal distribution uniform distribution convex support 
reasons modeling components log concave densities unimodal densities walther 
shown impossible set con dence intervals sided number modes multivariate distribution crucial aspect goal 
denote set single component distributions random variables see nd appropriate distribution consider moment population version corresponding gap statistic case means clustering log log min point set chosen minimize quantity population version corresponding subtracted logarithms variances 
looking favorable single component distribution 
theorem shows univariate case distribution uniform distribution theorem 
inf mse mse words unimodal distributions uniform produce spurious clusters gap test 
note problem invariant changes location scale allowing restrict attention uniform distribution supported unit interval 
calculations show mse mse formal similarity proposal lai marriott suggested estimate comparing successive di erences note procedure de ned important single component case 
importantly approach generally fail multivariate situation theorem distribution satisfy support degenerate subset line 
note assertion theorem contingent definition single component model 
apply say unimodal densities 
simple calculations show employing distribution degenerate support result ine procedure 
upshot theorem multivariate situation able choose generally applicable useful distribution geometry particular null distribution matters 
obvious solution generate data maximum likelihood estimate mle shown exist opposed mle unimodal distribution 
point time simple algorithms estimating simulating mle exist 
hand section shows insights gained theorems construct simple ective distribution 
computational implementation gap statistic lesson theorem multivariate variance structure matters 
idea exploit shape information principal components complicated structure provided mle 
consider choices distribution generate feature uniformly range observed values feature 
generate features uniform distribution box aligned principal components data 
detail data matrix assume columns mean zero compute singular value decomposition transform xv draw uniform features ranges columns method 
give data method advantage simplicity 
method takes account shape data distribution procedure rotationally invariant clustering method invariant 
case estimate log average copies log computed monte carlo sample drawn distribution 
need control sampling distribution gap statistic 
sd denote standard deviation monte carlo replicates log 
accounting additionally simulation error log results quantity sd 
choose cluster size smallest gap gap standard error style rule breiman 
empirically works problem 
re ned approach employ multiplier better control rejection null model 
computation gap statistic 
cluster observed data varying total number clusters giving dispersion measures 
generate datasets uniform prescription cluster giving dispersion measures kb compute estimated gap statistic gap log kb log 
log kb compute standard deviation sd log kb de ne sd choose number clusters smallest gap gap shows example means clustering 
data top left panel fall distinct clusters 
sum squares function displayed top right 
functions log log shown bottom left panel gap curve displayed bottom right standard error bars 
examines behavior gap estimate unclustered data 
raw data observations uniformly distributed unit square 
observed expected curves close gap estimate 
example application hierarchical clustering dna microarray data example data matrix gene expression measurements 
row represents gene column human tumor 
data taken ross 

columns label cancer type label clustering 
applied hierarchical agglomerative clustering columns squared error average linkage obtained dendogram 
surprisingly type clustered 
utility hierarchical clustering microarray data see ross 

results gap statistic shown 
estimated number clusters 
corresponding cut dendogram indicated horizontal line 
gap function starts rise clusters suggesting separated clusters separated ones 
approaches methods proposed estimating number clusters summary gordon 
divides approaches global local methods 
evaluate measure entire dataset optimize function number clusters 
consider individual pairs clusters test amalgamated 
gap method global procedure 
gordon global methods disadvantage unde ned cluster er indication data clustered 
milligan cooper carry comprehensive simulation comparison di erent procedures 
global methods performing 

number clusters number clusters obs exp log wk number clusters results cluster example 
data top left sum squares function displayed top right 
functions log log shown bottom left panel plotting symbol respectively gap curve displayed bottom right 


number clusters number clusters obs exp log wk number clusters results uniform data example 
data top left sum squares function displayed top right 
functions log log shown bottom left panel plotting symbol respectively gap curve displayed bottom right 
cns cns cns renal breast cns cns breast nsclc nsclc renal renal renal renal renal renal renal breast nsclc renal unknown ovarian melanoma prostate ovarian ovarian ovarian prostate nsclc leukemia leukemia leukemia leukemia leukemia leukemia leukemia colon colon colon colon colon colon colon breast breast breast breast nsclc nsclc melanoma melanoma melanoma melanoma melanoma dendogram dna microarray data 
horizontal line cuts tree leaving clusters suggested gap statistic number clusters number clusters log observed expected sum squares curves left gap statistic right dna microarray data best index due ch cluster sums squares clusters 
idea maximize ch number clusters ch de ned modi ed replacing value zero 
ch maximum occur 
mentioned earlier lai proposed quantity criterion choosing number clusters 
followed proposal marriott determinant trace sum squares matrix 
actual proposal lai de ned diff chose maximize quantity kl diff diff similar maximizing authors argue may better properties 
note kl de ned testing cluster versus 
hartigan proposed statistic idea start add cluster long large 
approximate distribution cuto hartigan suggests cluster added 
estimated number clusters smallest 
estimate de ned potentially discriminate versus cluster 
kaufman rousseeuw proposed silhouette statistic assessing clusters estimating optimal number 
observation average distance points cluster average distance points nearest cluster nearest de ned cluster minimizing average distance 
silhouette statistic de ned max point clustered large 
authors propose choose optimal number clusters value maximizing average dataset 
note de ned cluster 
simulations generated datasets di erent scenarios 
null single cluster data dimensions data points uniformly distributed unit square dimensions 
clusters dimensions clusters standard normal variables observations centered 
clusters dimensions cluster randomly chosen observations centers randomly chosen 

simulation clusters units apart discarded 

clusters dimensions cluster randomly chosen observations centers randomly chosen 

simulation clusters units apart discarded 
previous scenario settings half random realizations discarded 

elongated clusters dimensions 
cluster generated follows set equally spaced valued gaussian noise standard deviation added feature 
cluster generated way value added feature 
result elongated clusters stretching main diagonal dimensional cube 
realizations generated setting 
non null settings clusters overlap confusion de nition true number clusters 
applied di erent methods estimating number clusters ch kl hartigan silhouette 
gap unif gap method uniform distribution range observed feature gap pc uses uniform principal component orientation 
results table 
gap estimate uniform problem shape data adversely ects 
gap pc method uniform principal components orientation clear winner 
methods quite null setting gap estimate show reasonable performance 
course possible modify methods handle null single cluster case possibility simulate null distribution uniform data manner similar gap estimate 
overlapping classes simulation studies suggest gap estimate identifying separated clusters 
data separated notion cluster de ned literature 
table results simulation study 
numbers counts trials 
indicates column corresponding correct number clusters 
estimate number clusters method null model dimensions ch kl hartigan silhouette gap unif gap pc cluster model ch kl hartigan silhouette gap unif gap pc random cluster model dims 
ch kl hartigan silhouette gap unif gap pc random cluster model dims 
ch kl hartigan silhouette gap unif gap pc elongated clusters ch kl hartigan gap unif gap pc proportion points overlapping gap method overlapping data proportion times method chose cluster function proportion points overlap region subpopulations 
section small experiment assess gap method responds non separated data 
simulated data set consists observations bivariate normal populations means 
identity covariance 
sample computed gap estimate number clusters recorded proportion data points overlap region centroids 
done values 
running 
results shown 
roughly speaking overlap proportion probability selecting cluster estimating number principal components consider di erent related problem estimating number linear principal components needed approximating data cloud 
data ij features observa number principal components obs exp log sum squares number principal components gap method applied problem choosing optimal order linear principal components 
left panel shows observed expected value log reconstruction error log 
right panel shows gap curve maximum correct value principal components 
tions 
reconstruction error principal components approximate data 
detail ij projection ith data point rank principal component approximation 
ij ij order estimate best value apply gap method place example simulated data points model 



data lie close twodimensional manifold dimensional space 
results applying gap test shown 
gap curve clear maximum principal components 
course example just illustration problem requires study 
discussion problem estimating number clusters dataset dicult underlined fact clear de nition cluster 
data clearly separated groups di erent people di erent opinions number distinct clusters 
focussed separated clusters proposed gap statistic estimating number groups 
uniform distribution principal component orientation outperforms proposed methods literature simulations 
simpler uniform range data works data concentrated subspace 
dna microarray example shows importance graphing gap statistic simply extracting estimated maximum 
real data gap curve local maxima informative 
avenues research 
consideration possibilities distribution example proceed sequentially 
having clusters generate data separate uniform distributions support estimated data clusters 
principal component orientation produce better results 
especially useful develop methods ecient simulation data log concave maximum likelihood estimate 
distribution gap method compared uniform distribution 
proofs proof theorem setting shows mse min mse mse prove var var partition support write var dpx conditional variance standard arguments convolution gaussian kernel convolution result see thm 
dev consider nondegenerate cdf density logarithmically concave di erentiable interior support vanish 
dt dx log dx log nonincreasing logarithmically concave 
fact nondecreasing follows 
nonincreasing derivative concave 
write var dxdy dt symmetry fundamental theorem calculus 
change variable gives var dt proceeding likewise var obtains var dt set concavity 
holder inequality shown expression smaller dt dt var proving 
proof theorem uniformly distributed shows min 
inf consider nondegenerate support 
hand suppose satis es mse mse marginals theorem dev 
mse mse theorem clearly mse mse mse mse mse mse mse mse hold equality 
avoid technicalities give main arguments remainder proof 
proceeding similarly proof theorem concludes equality uniform distribution optimal centers equally spaced 
length support checks hold equality probability center closest index marginals set statement holds lebesgue measure 
theorem theorem dev support degenerate contained linear subspace repeating argument times proves theorem 
tibshirani hastie supported nsf nih 
breiman friedman olshen stone 
classi cation regression trees wadsworth 

dendrite method cluster analysis communications statistics 
dev 
convexity applications academic press 
gordon 
classi cation nd edition chapman hall crc press london 
hartigan 
clustering algorithms wiley new york 
kaufman rousseeuw 
finding groups data cluster analysis new york wiley 
lai 
criterion determining number groups data set sum squares clustering biometrics 
marriott 
practical problems method cluster analysis biometrics 
milligan cooper 
examination procedures determining number clusters data set psychometrika 
roeder 
graphical technique determining number components mixture normals journal american statistical association 
ross eisen spellman iyer rees je ery van de rijn waltham alexander lee lashkari myers weinstein botstein brown 
systematic variation gene expression patterns human cancer cell lines technical report stanford university 
scott simons 
clustering methods likelihood ratio criteria biometrics 
sugar 
techniques clustering classi cation applications medical problems technical report stanford university 
ph dissertation statistics olshen supervisor 
sugar olshen 
application cluster analysis health services research empirically de ned health states depression sf technical report stanford university 
walther 
nonparametric analysis mixture distribution technical report 
preparation 

